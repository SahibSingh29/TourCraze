{% extends 'main.html' %}

{% block content %}

{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'styles/home_page.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'styles/chatbot_styles.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts for Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
</head>

<body>
    {% include 'navbar.html' %}

    <!-- Main Content Section -->
    <div class="image-container">
        <div class="main-heading">
            Explore the sights<br>of
            <span id="element"></span>
        </div>
    </div>

    <!-- Typed.js Script for Dynamic Text -->
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <script>
        var typed = new Typed('#element', {
            strings: ['Manali', 'Mcleodganj', 'Nainital'],
            typeSpeed: 50,
            showCursor: false,
        });
    </script>

    <!-- Features Section -->
    <div class="features">
        <h2>Top values for you</h2>
        <p>Try variety of benefits when using our services</p>
    </div>

    <!-- Feature Content -->
    <div class="feature-content">
        <div class="custom-feature">
			<span class="icon-circle"><i class="fa-solid fa-map fa-lg"></i></span>
			<h5>Maps</h5>
			<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Repudiandae voluptates obcaecati placeat harum
				voluptatem iusto, tempore veritatis assumenda officia, recusandae nam delectus ipsam nemo? Aliquid
				delectus magnam possimus consequuntur voluptas?</p>
		</div>
		<div class="custom-feature">
			<span class="icon-circle"><i class="fa-solid fa-plane"></i></span>
			<h5>Tours and Plans</h5>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rem, quae corporis ex placeat saepe culpa
				eligendi. Aliquam aspernatur, quos maxime blanditiis voluptate dolorem officia laborum incidunt
				quibusdam ullam voluptatem nihil.</p>
		</div>
		<div class="custom-feature">
			<span class="icon-circle"><i class="fa-solid fa-comments"></i></span>
			<h5>Community</h5>
			<p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Omnis ratione explicabo distinctio dolor
				dolore, amet totam vero error fugit iure corrupti quis sed ipsa ducimus perspiciatis, voluptatum
				molestiae assumenda deleniti?</p>
		</div>
		<div class="custom-feature">
			<span class="icon-circle"><i class="fa-solid fa-landmark"></i></span>
			<h5>Famous Places</h5>
			<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ut adipisci consequuntur laborum, labore a ab
				mollitia atque quibusdam blanditiis dicta eaque deserunt aut nostrum optio sunt, quidem iusto reiciendis
				error.</p>
		</div>    
    </div>

    <!-- Carousel Section -->
    <div class="parent-slides">
        <div class="slides">
			<div id="carouselExample" class="carousel slide">
				<div class="carousel-inner">
					<div class="carousel-item active">
						<img src="{% static 'images/mountains.jpg' %}" class="d-block w-100" alt="Mountains">
					</div>
					<div class="carousel-item">
						<img src="{% static 'images/beach.jpg' %}" class="d-block w-100" alt="Beach">
					</div>
					<div class="carousel-item">
						<img src="{% static 'images/jaipur.jpg' %}" class="d-block w-100" alt="Forts">
					</div>
				</div>
				<button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"
					data-bs-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Previous</span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#carouselExample"
					data-bs-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Next</span>
				</button>
			</div>
		</div>    
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Explore Button -->
    <div class="explore">
        <a href="{% url 'maps' %}" class="btn btn-primary btn-lg" style="background-color: #02529C;">
            Find Location on Maps
        </a>    
    </div>

    <!-- Footer -->
    <div class="custom-footer">
        <footer class="footer">All rights are reserved 2024</footer>
    </div>

    <!-- Chatbot HTML Structure -->
    <button class="chatbot-toggler">
        <span class="material-symbols-rounded">mode_comment</span>
        <span class="material-symbols-outlined">close</span>
    </button>
    <div class="chatbot">
        <header>
            <h2>Chatbot</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox">
            <li class="chat incoming">
                <span class="material-symbols-outlined">smart_toy</span>
                <p>Hi there ðŸ‘‹<br>How can I help you today?</p>
            </li>
        </ul>
        <div class="chat-input">
            <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-rounded">send</span>
        </div>
    </div>

    <!-- Chatbot JavaScript -->
    <script type="importmap">
        {
            "imports": {
                "@google/generative-ai": "https://esm.run/@google/generative-ai"
            }
        }
    </script>
    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const genAI = new GoogleGenerativeAI('AIzaSyAh-h1nJKCUO6kk_nloZmNa9E007K50HJg');

        const chatbotToggler = document.querySelector(".chatbot-toggler");
        const closeBtn = document.querySelector(".close-btn");
        const chatbox = document.querySelector(".chatbox");
        const chatInput = document.querySelector(".chat-input textarea");
        const sendChatBtn = document.querySelector(".chat-input span");

        let userMessage = null;
        const inputInitHeight = chatInput.scrollHeight;

        async function runModel(userPrompt) { // Renamed 'prompt' to 'userPrompt'
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
            const result = await model.generateContent(userPrompt);
            const response = await result.response;
            const text = await response.text();
            return text;
        }

        const createChatLi = (message, className) => {
            const chatLi = document.createElement("li");
            chatLi.classList.add("chat", `${className}`);
            let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">smart_toy</span><p></p>`;
            chatLi.innerHTML = chatContent;
            chatLi.querySelector("p").textContent = message;
            return chatLi;
        }

        const generateResponse = async (chatElement, userMessage) => {
            const messageElement = chatElement.querySelector("p");
            try {
                const answer = await runModel(userMessage);
                messageElement.textContent = answer;
            } catch (error) {
                console.log("Failed to generate response", error);
                messageElement.textContent = "Sorry, something went wrong!";
            }
            chatbox.scrollTo(0, chatbox.scrollHeight);
        }

        const handleChat = () => {
            userMessage = chatInput.value.trim();
            if (!userMessage) return;

            chatInput.value = "";
            chatInput.style.height = `${inputInitHeight}px`;

            chatbox.appendChild(createChatLi(userMessage, "outgoing"));
            chatbox.scrollTo(0, chatbox.scrollHeight);

            setTimeout(() => {
                const incomingChatLi = createChatLi("Thinking...", "incoming");
                chatbox.appendChild(incomingChatLi);
                chatbox.scrollTo(0, chatbox.scrollHeight);
                generateResponse(incomingChatLi, userMessage);
            }, 600);
        }

        chatInput.addEventListener("input", () => {
            chatInput.style.height = `${inputInitHeight}px`;
            chatInput.style.height = `${chatInput.scrollHeight}px`;
        });

        chatInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
                e.preventDefault();
                handleChat();
            }
        });

        sendChatBtn.addEventListener("click", handleChat);
        closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
        chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));
    </script>
</body>

{% endblock %}
